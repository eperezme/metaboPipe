# Save data as a csv file
# write.csv(data, file = "data.csv")
##### PREPARING DATA FOR EXPERIMENT ######
# Create SampleMetadata dataframe
SM <- data[,1:7]
SM$sample_id = SM$label
# Define QC and blank samples
blanks=c(1,2,33,34,65,66)
QCs=c(3,4,11,18,25,32,35,36,43,50,57,64)
SM$sample_type = "Sample"
SM$sample_type[blanks] = "Blank"
SM$sample_type[QCs] = "QC"
# Create variableMetadata object
VM = data.frame('annotation'=colnames(data)[8:ncol(data)])
# Create the raw data matrix
X = data[,8:ncol(data)]
X$sample_id = SM$sample_id
# Save data as csv files
write.csv(X, file = "data/dataMatrix.csv", row.names = FALSE)
write.csv(SM, file = "data/sampleMetadata.csv", row.names = FALSE)
write.csv(VM, file = "data/variableMetadata.csv", row.names = FALSE)
# Create the experiment
DE <- createExperiment(X, SM, VM, "LCMS Raw test", "Description Test")
DE
####### FILTERING AND IMPUTATION #######
# Filter NA
filtered_experiment <- filter_MV(DE)
filtered_experiment
mainImputed_experiment <- impute_MAI(DE, "random_forest", "PPCA")
mainImputed_experiment <- impute_MAI(filtered_experiment, "random_forest", "PPCA")
mainImputed_experiment <- impute_MAI(DE, "random_forest", "PPCA")
View(mainImputed_experiment)
mainImputed_experiment
assay(main)
assay(mainImputed_experiment)
imp <- as.data.frame(assay(mainImputed_experiment))
View(imp)
View(assay(DE))
source("C:/Users/eduar/Desktop/TFM/Work/R/MAI/utils.R")
mainImputed_experiment <- impute_MAI(DE, "random_forest", "PPCA")
source("C:/Users/eduar/Desktop/TFM/Work/R/imputation.R")
source("C:/Users/eduar/Desktop/TFM/Work/R/MAI/MAI.R")
source("C:/Users/eduar/Desktop/TFM/Work/R/MAI/utils.R")
source("C:/Users/eduar/Desktop/TFM/Work/R/MAI/utils.R")
source("C:/Users/eduar/Desktop/TFM/Work/R/MAI/MAI.R")
source("C:/Users/eduar/Desktop/TFM/Work/R/imputation.R")
mainImputed_experiment <- impute_MAI(DE, "random_forest", "PPCA")
source("C:/Users/eduar/Desktop/TFM/Work/R/imputation.R")
mainImputed_experiment <- impute_MAI(DE, "random_forest", "PPCA")
View(assay(mainImputed_experiment))
QRImputed_experiment <- impute_QRILC(filtered_experiment)
RFImputed_experiment <- impute_RF(filtered_experiment)
plot_density <- function(original_data, imputed_data) {
for (col in names(original_data)) {
original_density <- ggplot(data = original_data, aes(x = original_data[[col]])) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = paste("Density Plot of", col, "(Original Data)"))
imputed_density <- ggplot(data = imputed_data, aes(x = imputed_data[[col]])) +
geom_density(fill = "red", alpha = 0.5) +
labs(title = paste("Density Plot of", col, "(Imputed Data)"))
print(original_density)
print(imputed_density)
}
}
plot_histograms(imp, as.data.frame(assay(mainImputed_experiment)))
plot_density(imp, as.data.frame(assay(mainImputed_experiment)))
plot_density(imp$N_methyl_L_histidine, as.data.frame(assay(mainImputed_experiment))$N_methyl_L_histidine)
plot_density(imp$N_methyl_L_histidine, as.data.frame(assay(mainImputed_experiment))$N_methyl_L_histidine)
plot_histograms <- function(original_data, imputed_data) {
for (col in names(original_data)) {
original_hist <- ggplot(data = original_data, aes(x = original_data[[col]])) +
geom_histogram(binwidth = 1, fill = "blue", alpha = 0.5) +
labs(title = paste("Histogram of", col, "(Original Data)"))
imputed_hist <- ggplot(data = imputed_data, aes(x = imputed_data[[col]])) +
geom_histogram(binwidth = 1, fill = "red", alpha = 0.5) +
labs(title = paste("Histogram of", col, "(Imputed Data)"))
print(original_hist)
print(imputed_hist)
}
}
plot_histograms(imp$N_methyl_L_histidine, as.data.frame(assay(mainImputed_experiment))$N_methyl_L_histidine)
mainImputed_experiment <- impute_MAI(DE, "random_forest", "PPCA")
new <- as.data.frame(assay(mainImputed_experiment))
plot_histograms(imp, new)
warnings()
plot_histograms(imp$N_methyl_L_histidine, new$N_methyl_L_histidine)
plot_histograms <- function(original_data, imputed_data) {
for (col in names(original_data)) {
original_hist <- ggplot(data = NULL, aes(x = original_data[[col]])) +
geom_histogram(binwidth = 1, fill = "blue", alpha = 0.5) +
labs(title = paste("Histogram of", col, "(Original Data)"))
imputed_hist <- ggplot(data = NULL, aes(x = imputed_data[[col]])) +
geom_histogram(binwidth = 1, fill = "red", alpha = 0.5) +
labs(title = paste("Histogram of", col, "(Imputed Data)"))
print(original_hist)
print(imputed_hist)
}
}
plot_histograms(imp$N_methyl_L_histidine, new$N_methyl_L_histidine)
hist(imp$N_methyl_L_histidine)
plot_histograms_single <- function(original_var, imputed_var) {
original_hist <- ggplot(data = NULL, aes(x = original_var)) +
geom_histogram(binwidth = 1, fill = "blue", alpha = 0.5) +
labs(title = "Histogram Comparison") +
geom_histogram(data = NULL, aes(x = imputed_var), binwidth = 1, fill = "red", alpha = 0.5) +
labs(title = "Histogram Comparison") +
scale_fill_manual(name = "Data", values = c("blue", "red"), labels = c("Original", "Imputed")) +
theme_minimal()
print(original_hist)
}
plot_histograms_single(imp$N_methyl_L_histidine, new$N_methyl_L_histidine)
# Function to plot density plots for one variable
plot_density_single <- function(original_var, imputed_var) {
original_density <- ggplot(data = NULL, aes(x = original_var)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot Comparison") +
geom_density(data = NULL, aes(x = imputed_var), fill = "red", alpha = 0.5) +
labs(title = "Density Plot Comparison") +
scale_fill_manual(name = "Data", values = c("blue", "red"), labels = c("Original", "Imputed")) +
theme_minimal()
print(original_density)
}
# Call the function to plot density plots for one variable
plot_density_single(new$N_methyl_L_histidine, imp$N_methyl_L_histidine)
# Function to plot density plots for one variable with a legend
plot_density_single_with_legend <- function(original_var, imputed_var) {
original_density <- ggplot(data = NULL, aes(x = original_var, fill = "Original")) +
geom_density(alpha = 0.5) +
labs(title = "Density Plot Comparison") +
geom_density(data = NULL, aes(x = imputed_var, fill = "Imputed"), alpha = 0.5) +
labs(title = "Density Plot Comparison") +
scale_fill_manual(name = "Data", values = c("Original" = "blue", "Imputed" = "red")) +
theme_minimal()
print(original_density)
}
# Call the function to plot density plots for one variable with a legend
plot_density_single_with_legend(new$N_methyl_L_histidine, imp$N_methyl_L_histidine)
source("C:/Users/eduar/Desktop/TFM/Work/R/Plots.R")
plot_density_single_with_legend(new$N_methyl_L_histidine, imp$N_methyl_L_histidine)
plot_density_single_with_legend <- function(original_var, imputed_var, third_var) {
original_density <- ggplot(data = NULL, aes(x = original_var, fill = "Original")) +
geom_density(alpha = 0.5) +
labs(title = "Density Plot Comparison") +
geom_density(data = NULL, aes(x = imputed_var, fill = "Imputed"), alpha = 0.5) +
labs(title = "Density Plot Comparison") +
geom_density(data = NULL, aes(x = third_var, fill = "Third"), alpha = 0.5) +
labs(title = "Density Plot Comparison") +
scale_fill_manual(name = "Data", values = c("Original" = "blue", "Imputed" = "red", "Third" = "green")) +
theme_minimal()
print(original_density)
}
orig <- DE$data
View(data)
View(orig)
plot_density_single_with_legend(new$N_methyl_L_histidine, imp$N_methyl_L_histidine, orig$N_methyl_L_histidine)
renv::status()
?renv::status()
renv::restore()
library(targets)
tar_visnetwork()
suppressPackageStartupMessages({
# Bioconductor packages
library(SummarizedExperiment)
library(structToolbox)
library(pmp)
library(ropls)
library(BiocFileCache)
# CRAN libraries
library(ggplot2)
library(gridExtra)
library(cowplot)
library(openxlsx)
library(VIM)
library(dplyr)
library(caret)
library(missForest)
library(pcaMethods)
library(parallel)
})
library(targets)
renv::restore()
library(targets)
tar_visnetwork()
renv::status()
VIM::
VIM::aggr()
tar_renv(
extras = c(
"caret"
)
)
renv::restore()
install.packages("caret")
MASS::abbey
suppressPackageStartupMessages({
# Bioconductor packages
library(SummarizedExperiment)
library(structToolbox)
library(pmp)
library(ropls)
library(BiocFileCache)
# CRAN libraries
library(ggplot2)
library(gridExtra)
library(cowplot)
library(openxlsx)
library(VIM)
library(dplyr)
library(caret)
library(missForest)
library(pcaMethods)
library(parallel)
})
# Source all files in the R/ directory
file.sources <- list.files("R", pattern = "*.R", full.names=TRUE)
invisible(sapply(file.sources, source, .GlobalEnv))
# file.sources <- list.files("R/MAI", pattern = "*.R", full.names=TRUE)
# invisible(sapply(file.sources, source, .GlobalEnv))
# use the BiocFileCache
bfc <- BiocFileCache(ask = FALSE)
# path to zip
zipfile = "https://raw.github.com/STATegraData/STATegraData/master/Script_STATegra_Metabolomics.zip"
## retrieve from BiocFileCache
path = bfcrpath(bfc,zipfile)
temp = bfccache(bfc)
## ... or download to temp location
# path = tempfile()
# temp = tempdir()
# download.file(zipfile,path)
# unzip
unzip(zipfile=path, files = "LC_MS_raw_data.xlsx", exdir=temp)
# read samples
data <- as.data.frame(read.xlsx(file.path(temp,"LC_MS_raw_data.xlsx"),sheet = 'Data'))
# Save data as a csv file
# write.csv(data, file = "data.csv")
##### PREPARING DATA FOR EXPERIMENT ######
# Create SampleMetadata dataframe
SM <- data[,1:7]
SM$sample_id = SM$label
# Define QC and blank samples
blanks=c(1,2,33,34,65,66)
QCs=c(3,4,11,18,25,32,35,36,43,50,57,64)
SM$sample_type = "Sample"
SM$sample_type[blanks] = "Blank"
SM$sample_type[QCs] = "QC"
# Create variableMetadata object
VM = data.frame('annotation'=colnames(data)[8:ncol(data)])
# Create the raw data matrix
X = data[,8:ncol(data)]
X$sample_id = SM$sample_id
# Save data as csv files
write.csv(X, file = "data/dataMatrix.csv", row.names = FALSE)
write.csv(SM, file = "data/sampleMetadata.csv", row.names = FALSE)
write.csv(VM, file = "data/variableMetadata.csv", row.names = FALSE)
# Create the experiment
DE <- createExperiment(X, SM, VM, "LCMS Raw test", "Description Test")
DE
####### FILTERING AND IMPUTATION #######
# Filter NA
filtered_experiment <- filter_MV(DE)
library(VIM)
# Filter NA
filtered_experiment <- filter_MV(DE)
par()
# Filter NA
filtered_experiment <- filter_MV(DE)
filtered_experiment
impute_median(filtered_experiment)
test<-impute_median(filtered_experiment)
test
test$data
tar_visnetwork()
renv::status
renv::status()
renv::snapshot()
tar_make()
library(crew)
tar_make()
tar_make()
getwd()
tar_make()
tar_make()
tar_make()
source("~/Desktop/TFM/Work/R/imputation.R")
impute_mean(filtered_experiment)
impute_mean(filtered_experiment)
imputed_data
debugSource("~/Desktop/TFM/Work/R/imputation.R")
impute_mean(filtered_experiment)
tar_make()
install.packages("quatro")
quatro
install.packages("quatro")
install.packages("tarchetypes")
tar_visnetwork()
renv::status()
renv::status()
renv::snapshot()
tar_active()
tar_make()
tar_visnetwork()
tar_visnetwork()
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
tar_visnetwork()
renv::restore()
remotes::install_github("rileytwo/darkstudio")
remotes::install_github("anthonynorth/rscodeio")
rscodeio::install_theme()
rscodeio::install_theme()
# install.packages("devtools")
devtools::install_github("gadenbuie/rsthemes")
rscodeio::deactivate_menu_theme
rscodeio::deactivate_menu_theme()
rsthemes::install_rsthemes()
suppressPackageStartupMessages({
# Bioconductor packages
library(SummarizedExperiment)
library(structToolbox)
library(pmp)
library(ropls)
library(BiocFileCache)
# CRAN libraries
library(ggplot2)
library(gridExtra)
library(cowplot)
library(openxlsx)
library(VIM)
library(dplyr)
library(caret)
library(missForest)
library(pcaMethods)
library(parallel)
})
renv::paths$library()
lintr:::addin_lint()
lintr:::addin_lint()
styler:::style_active_file()
styler:::style_active_file()
styler:::style_selection()
styler:::set_style_transformers()
styler:::style_active_file()
lintr:::addin_lint()
#' @param dataMatrix
#' @param sampleMetadata
#' @param variableMetadata
#' @param experiment_name
#' @param experiment_description
#'
#' @return A \code{DatasetExperiment} object.
#' @export
#'
#' @examples
createExperiment <- function(dataMatrix, sampleMetadata, variableMetadata,
experiment_name = "Name", experiment_description = "Description") {
# dataMatrix should have a row for each sample and a column for each feature
# Check dimensions
if (nrow(dataMatrix) != nrow(sampleMetadata)) {
stop("Number of rows in dataMatrix and sampleMetadata do not match.")
}
if (ncol(dataMatrix) - 1 != nrow(variableMetadata)) {
stop("Number of (columns - 1) in dataMatrix and rows in variableMetadata do not match.")
}
# Drop dataMatrix$sample_id
dataMatrix$sample_id <- NULL
# Create new annotation col for variableMetadata == colnames of dataMatrix
variableMetadata$annotation <- colnames(dataMatrix)
# Make metabolites underscore for compatibility
colnames(dataMatrix) <- gsub("-", "_", colnames(dataMatrix))
# convert 0 to NA
dataMatrix[dataMatrix == 0] <- NA
dataMatrix <- data.frame(lapply(dataMatrix, as.numeric), check.names = FALSE)
# Check row/col names match
rownames(dataMatrix) <- sampleMetadata$sample_id
rownames(sampleMetadata) <- sampleMetadata$sample_id
rownames(variableMetadata) <- colnames(dataMatrix)
# Create a DatasetExperiment object
# require(structToolbox)
DE <- DatasetExperiment(
data = dataMatrix,
sample_meta = sampleMetadata,
variable_meta = variableMetadata,
name = experiment_name,
description = experiment_description
)
return(DE)
}
?createExperiment()
roxygen2::roxygenise()
renv::install.packages("gt")
install.packages("gt")
quatro::
install.packages("quatro")
library(MetaboAnalystR)
DE_to_metaboanalyst <- function(dataset_experiment) {
# Extract the data matrix
data_matrix <- SummarizedExperiment::assay(dataset_experiment)
# Extract the sample metadata
sample_metadata <- DataFrame::as.data.frame(colData(dataset_experiment))
# Extract the variable metadata
variable_metadata <- DataFrame::as.data.frame(rowData(dataset_experiment))
# Convert the data matrix to a data frame
data_frame <- as.data.frame(data_matrix)
# Add the sample metadata to the data frame
data_frame <- cbind(sample_metadata, data_frame)
# Add the variable metadata to the data frame
data_frame <- cbind(variable_metadata, data_frame)
return(data_frame)
}
InitStatAnalMode()
mSet <- InitDataObjects("conc", "stat", FALSE)
par(family="FiraCode")
mSet <- InitDataObjects("conc", "stat", FALSE)
mSet <- InitDataObjects("conc", "stat", FALSE);
metabo_data()
metaboanalyst_env
library(dplyr)
mSet <- InitDataObjects("conc", "stat", FALSE);
mSet <- Read.TextData(mSet, "data/metaboData.csv")
mSet<-SanityCheckData(mSet);
View(mSet)
mSet[["dataSet"]]
mSet<-ReplaceMin(mSet);
mSet<-PreparePrenormData(mSet);
mSet<-Normalization(mSet, "NULL", "LogNorm", "MeanCenter", "S10T0", ratio=FALSE, ratioNum=20);
mSet<-PlotNormSummary(mSet, "norm_0_", format ="png", dpi=72, width=NA);
mSet<-PlotSampleNormSummary(mSet, "snorm_0_", format = "png", dpi=72, width=NA);
mSet<-PlotSampleNormSummary(mSet, "snorm_0_", format = "png", dpi=72, width=NA)
mSet
plot(mSet)
plot(mSet$norm_0_1)
plot(mSet$norm_0_)
plot(mSet$snorm_0_)
mSet[["dataSet"]]
mSet[["dataSet"]][["norm"]]
mSet<-Normalization(mSet, "NULL", "LogNorm", "MeanCenter", "1358BZU_0025_A1_11_0_Control", ratio=FALSE, ratioNum=20);
mSet<-PlotNormSummary(mSet, "norm_0_", format ="png", dpi=72, width=NA);
mSet<-PlotSampleNormSummary(mSet, "snorm_0_", format = "png", dpi=72, width=NA)
plot(mSet$snorm_0_)
mSet<-PreparePrenormData(mSet);
mSet<-Normalization(mSet, "NULL", "LogNorm", "MeanCenter", "1358BZU_0025_A1_11_0_Control", ratio=FALSE, ratioNum=20);
PlotNormSummary(mSet, "norm_0_", format ="png", dpi=72, width=NA);
PlotSampleNormSummary(mSet, "snorm_0_", format = "png", dpi=72, width=NA)
mSet<-Normalization(mSet, "NULL", "LogNorm", "MeanCenter", "", ratio=FALSE, ratioNum=20);
mSet<-PlotNormSummary(mSet, "norm_0_", format ="png", dpi=72, width=NA);
mSet<-PlotSampleNormSummary(mSet, "snorm_0_", format = "png", dpi=72, width=NA)
mSet<-PlotSampleNormSummary(mSet, "snorm_0_", format = "svg", dpi=72, width=NA)
mSet<-PlotNormSummary(mSet, "norm_0_", format ="svg", dpi=72, width=NA);
mSet<-PlotNormSummary(mSet, "plots/norm_0_", format ="svg", dpi=72, width=NA);
rm(list = ls())
library(MetaboAnalystR)
mSet <- InitDataObjects("conc", "stat", FALSE);
mSet <- Read.TextData(mSet, "data/metaboData.csv")
mSet<-SanityCheckData(mSet);
mSet<-ReplaceMin(mSet);
mSet<-PreparePrenormData(mSet);
mSet<-Normalization(mSet, "NULL", "LogNorm", "MeanCenter", "", ratio=FALSE, ratioNum=20);
mSet<-PlotNormSummary(mSet, "plots/norm_0_", format ="svg", dpi=72, width=NA);
mSet<-PlotSampleNormSummary(mSet, "plots/snorm_0_", format = "svg", dpi=72, width=NA)
print(mSet$msgSet$read.msg)
setwd("./analysis")
setwd(dir = "./analysis")
setwd(dir = "./analysis")
dir.create("analysis")
getwd
dir.create("analysis")
dir.create("analysis", showWarnings = FALSE)
setwd("..")
getwd()
# Load a dataframe to metaboanalystR data object
# mSet <- InitDataObjects("conc", "stat", FALSE);
# mSet <- Read.TextData(mSet, "")
wd <- getwd()
getwd()
# Load a dataframe to metaboanalystR data object
# mSet <- InitDataObjects("conc", "stat", FALSE);
# mSet <- Read.TextData(mSet, "")
wd <- getwd()
out_dir <- "analysis"
if (!dir.exists(out_dir)) {
dir.create(out_dir)
}
setwd(file.path(wd, out_dir))
getwd()
mSet <- InitDataObjects("conc", "stat", FALSE);
mSet <- Read.TextData(mSet, "data/metaboData.csv")
mSet <- Read.TextData(mSet, filePath = file.path(wd, "data/metaboData.csv"))
mSet<-SanityCheckData(mSet);
# mSet<-ReplaceMin(mSet);
mSet <- RemoveMissingPercent(mSet, percent=0.5)
mSet <- InitDataObjects("conc", "stat", FALSE);
mSet <- Read.TextData(mSet, filePath = file.path(wd, "data/metaboData.csv"))
mSet<-SanityCheckData(mSet);
# mSet<-ReplaceMin(mSet);
mSet <- RemoveMissingPercent(mSet, percent=0.5) #Remove features containing a user-defined % cut-off of missing values
# mSet <- ImputeMissingVar(mSet, method="exclude") #Remove variables with missing values
mSet <- ImputeMissingVar(mSet, method="knn_smp") #Replace missing values with KNN imputed values
# Check if the sample size is too small, returns a 0 if the data passes the check
mSet<-IsSmallSmplSize(mSet)
mSet<-PreparePrenormData(mSet);
plot_dir <- "plots"
if (!dir.exists(plot_dir)) {
dir.create(plot_dir)
}
mSet<-PreparePrenormData(mSet);
mSet<-Normalization(mSet, "NULL", "LogNorm", "MeanCenter", "", ratio=FALSE, ratioNum=20);
mSet<-PlotNormSummary(mSet, file.path(plot_dir, "norm_0_"), format ="svg", dpi=72, width=NA);
mSet<-PlotSampleNormSummary(mSet, file.path(plot_dir, "snorm_0_"), format = "svg", dpi=72, width=NA)
